### [Flask留言板练手项目](https://114514.pythonanywhere.com/#)

>  再次重写留言板，该版将会代替旧版。
>
> 开始日期：2020年3月19日
>
> 结束日期：暂定

#### 新版新增功能

* ~~用户认证（关于用户发帖修改功能这方面认证暂且没有明确思路）~~
* 管理员账户修改/删除留言
* ~~一对多的用户留言数据表~~ 
  * 还是改为匿名发送了
* 使用flex布局
* 留言置顶 

#### 需要用到的轮子

- flask_sqlalchemy 数据库相关
- flask_login 用户认证相关
- flask_migrate 数据库迁移工具
- flask_wtf 表单相关
- wtforms 同上

#### 2020年3月20日 进度

* 完成发送留言页布局
* 发送页面实现置顶功能
* 完成日志页（逻辑基本和显示留言一样）
* 实现登录功能

自此基本功能基本都已经实现了，剩下的管理员删除留言，隐藏留言块等功能需要用到js，这部分也不难，先放着，随缘实现（屑颜）。

**踩的坑**

1. 使用*.flaskenv*设置shell上下文时，`FLASK_APP`的值不能和包名相同，也就是说如果有个`app.py`作为启动文件，那么组件包名就不能为app，反之亦然。
2. 给标题字段设置了一个默认值，但是flask-form文本字段返回的空值为空文本，而不是None，所以还是得在代码里判断用户是否输入标题

**数据库迁移也忘了，在这里记录一下正确步骤**

1. flask db init 仅在初始化时调用
2. flask db migrate
3. flask db upgrade/downgrade 升级/回滚

**一些闲话**

代码仍是先实现布局再实现逻辑，删删改改一下午就过去了。不得不说调试真的不方便，无奈电脑带PyCharm太卡，Geany虽然相比没那么方便但也够用。

置顶留言功能加个flag然后在查询的时候排个序就行，之前还单独搞一个表存（而且功能也没实现），想法太天真了w。

表单这部分感觉手熟些了。除了用wtf.quick_form，关于用wtf生成的元素的样式定义目前看到的教程貌似都没有提到，之前用的时候Bootstrap类名和自己定义的有冲突，怕这次也会出现类似的问题，所以这条放弃。其实在类中定义元素时的变量名是作为元素id自动添加的，所以可以利用css设置元素样式，但是把id硬编码到css也不是个太好的方法（如果修改元素变量名，可能会导致原先样式失效），不过够用。

#### 2020年3月19日 进度

* 主页面布局基本搞定（先写的布局，还没开始写逻辑，感觉有点本末倒置w，不过一开始太简陋也看不下去，接下来就专注逻辑了）。

**待完成**

* 用户注册\登录页面
* 发送留言页面
* 日志页面
